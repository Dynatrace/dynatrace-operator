name: Helm-Check

on:
  push:
    branches:
      - master
      - release-*
    paths:
      - 'config/helm/**'
      - '!config/helm/repo/**'
  pull_request:
    branches:
      - "*"
    paths:
      - 'config/helm/**'
      - '!config/helm/repo/**'

env:
  GO_VERSION: "^1.18"
  DOCKER_REGISTRY: "quay.io"
  DOCKER_REPOSITORY: "dynatrace/dynatrace-operator"

jobs:
  helm-test:
    name: Run helm unit tests
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Set up Helm
        uses: azure/setup-helm@v1
        with:
          version: v3.7.1
      - name: Download dependencies
        id: helm-unittest-download
        run: |
          hack/build/ci/install-helm-dependencies.sh
      - name: Run Unit tests
        id: helm-unittest
        run: |
          make test/helm/unit

  helm-lint:
    name: Run helm linting
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Set up Helm
        uses: azure/setup-helm@v1
        with:
          version: v3.8.2
      - name: Run Linting
        id: helm-linting
        run: |
          make test/helm/lint

