#!/bin/sh
gomarkdoc_header="<!-- Code generated by gomarkdoc. DO NOT EDIT -->"
script_header="<!-- Code generated by ./hack/doc/gen_feature_flags.sh - DO NOT EDIT -->"
doc_dir="./pkg/api/v1beta1/dynakube"
output_dir="./doc/api"
output_file="feature-flags.md"
output=""

# gomarkdoc only works with directories -> as we only want to generate docs for feature_flags.go, we copy it to a new /tmp dir
mkdir ${doc_dir}/tmp
cp ${doc_dir}/feature_flags.go ${doc_dir}/tmp

output="${output}$(gomarkdoc ${doc_dir}/tmp | sed 's/\\//g')"

# remove gomarkdoc footer
output=$(echo "${output}" | sed '$d')

# remove gomarkdoc headers and add custom one
output=$(echo "${output}" | sed s/"$gomarkdoc_header"//)
output="${script_header}\n${output}"

# write output to file
mkdir -p $output_dir
echo "$output" > $output_dir/$output_file

# fix linting issues
markdownlint -f $output_dir/$output_file

# remove tmp dir
rm -r ${doc_dir}/tmp
